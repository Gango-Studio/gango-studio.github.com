<!DOCTYPE html>
<html>
<head>
    <title>圆形节拍器</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #f0f0f0;
            font-family: Arial, sans-serif;
        }

        .wheel-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 50px;
        }

        .control-wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(45deg, #333, #000);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            cursor: pointer;
            touch-action: none;
        }

        .center-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            background: #fff;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #bpm {
            font-size: 2em;
            font-weight: bold;
        }

        button {
            margin: 20px;
            padding: 10px 20px;
            font-size: 1.2em;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="wheel-container">
        <div class="control-wheel"></div>
        <div class="center-display">
            <span id="bpm">120</span>
            <span>BPM</span>
        </div>
    </div>
    <button id="toggle">Start</button>

    <script>
        // Base64编码的节拍器音频（短促的滴答声）
        const audioData = "data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU";
        
        // 初始化音频
        const audio = new Audio(audioData);
        let isPlaying = false;
        let intervalId = null;
        let rotation = 0;
        let currentBpm = 120;

        // 控制滚轮元素
        const wheel = document.querySelector('.control-wheel');
        const bpmDisplay = document.getElementById('bpm');
        const toggleBtn = document.getElementById('toggle');

        // 鼠标事件处理
        let isDragging = false;
        let lastAngle = 0;

        wheel.addEventListener('mousedown', startDrag);
        document.addEventListener('mousemove', handleDrag);
        document.addEventListener('mouseup', stopDrag);

        function startDrag(e) {
            isDragging = true;
            const rect = wheel.getBoundingClientRect();
            const centerX = rect.left + rect.width/2;
            const centerY = rect.top + rect.height/2;
            lastAngle = Math.atan2(e.clientY - centerY, e.clientX - centerX);
        }

        function handleDrag(e) {
            if (!isDragging) return;
            
            const rect = wheel.getBoundingClientRect();
            const centerX = rect.left + rect.width/2;
            const centerY = rect.top + rect.height/2;
            const currentAngle = Math.atan2(e.clientY - centerY, e.clientX - centerX);
            
            const angleDiff = currentAngle - lastAngle;
            rotation += angleDiff * (180 / Math.PI); // 转换为角度
            rotation = rotation % 360;
            
            // 更新BPM（每度对应1 BPM变化）
            currentBpm = Math.round(120 + rotation);
            currentBpm = Math.max(30, Math.min(240, currentBpm)); // 限制30-240 BPM
            
            bpmDisplay.textContent = currentBpm;
            wheel.style.transform = `rotate(${rotation}deg)`;
            
            lastAngle = currentAngle;
        }

        function stopDrag() {
            isDragging = false;
        }

        // 节拍器控制
        toggleBtn.addEventListener('click', () => {
            isPlaying = !isPlaying;
            toggleBtn.textContent = isPlaying ? 'Stop' : 'Start';
            
            if (isPlaying) {
                const interval = 60000 / currentBpm; // BPM转换为毫秒
                intervalId = setInterval(() => {
                    audio.currentTime = 0;
                    audio.play().catch(() => {});
                }, interval);
            } else {
                clearInterval(intervalId);
            }
        });
    </script>
</body>
</html>
